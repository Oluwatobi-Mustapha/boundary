version: "1.0"

settings:
  default_action: deny
  max_request_duration_hours: 12

# Define who the actors are.
# Secrets are now injected via Environment Variables.
subjects:
  groups:
    developers:
      id: "${BOUNDARY_DEVELOPERS_ID}"
      description: "Core App Developers"
    security_admins:
      id: "${BOUNDARY_SECURITY_ADMINS_ID}"
      description: "Cloud Security Team"

rules:
  # RULE 1: Staging Read Only
  - id: "allow-dev-staging-ro"
    description: "Developers can request ReadOnly on Staging OU"
    subjects: ["developers"]
    effect: allow
    target:
      selector: "ou_id"
      ids: ["${STAGING_OU_ID}"]
    permission_set: "ReadOnlyAccess"
    constraints:
      max_duration_hours: 8
      ticket_required: false

  # RULE 2: Sandbox Admin
  - id: "allow-dev-sandbox-admin"
    description: "Developers can request Admin on Sandbox accounts"
    subjects: ["developers"]
    effect: allow
    target:
      selector: "tag"
      key: "Environment"
      values: ["Sandbox", "Playground"]
    permission_set: "AdministratorAccess"
    constraints:
      max_duration_hours: 1
      ticket_required: true
    approval:
      required: true
      approver_groups: ["security_admins"]
      channel: "#security-approvals"

  # RULE 3: Explicit Deny
  - id: "deny-dev-prod"
    description: "Explicitly forbid developers from Production OUs"
    subjects: ["developers"]
    effect: deny
    target:
      selector: "ou_id"
      ids: ["${STAGING_OU_ID}"] # Typically this would be PROD_OU_ID, but using STAGING as per your last file
    permission_set: "*"